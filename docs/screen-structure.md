# 画面構成

## 共通UI指針
- 1画面1アクションを太く: 上部に主要CTA、下部に補助CTAを配置。
- 空状態はイラスト/アイコン + 見出し + 一行説明 + CTAボタン。
- タグはカラー付きチップ。タップ時は選択状態を示し、検索/フィルタと整合。

## タブ構成（3タブ）

### 1. 歌詞（Projects）画面 (`app/index.tsx`)
**機能**: プロジェクト一覧/作成、フォルダによる整理。
- 空状態（フォルダ未作成時）: 見出し「まずはプロジェクトの整理方法を決めましょう」。CTA1（太ボタン）「フォルダを作成」、CTA2（テキストリンク）「スキップして最初のプロジェクトを作る」。フォルダを作らず始めた場合は全プロジェクトが「フォルダなし」タブに溜まる仕様。
- 空状態（フォルダあり/プロジェクト0件）: 「プロジェクトを作成」CTAを中央に。フォルダ切替タブは表示。
- プロジェクトカード: タイトル、更新日時、フォルダバッジ。スワイプ削除/複数選択は後回し、まずはタップで詳細/シンプル操作に絞る。
- フォルダ切替: 上部に横スクロールのセグメント。タブ例: すべて / フォルダA / フォルダB / フォルダなし。右端に「+」アイコンでフォルダ追加。フォルダなしも常時表示。
- フレーズ挿入への導線: プロジェクト詳細から「フレーズを挿入」ボタン（後述のモーダルを開く）。
- プロジェクトのフォルダ移動: カード長押し or 複数選択モードで「フォルダに移動」を表示し、シートでフォルダ一覧を選択。フォルダなしも選択肢として常に表示。

### 2. フレーズ（Phrases）画面 (`app/phrases.tsx`)
**機能**: フレーズのストック、検索、タグ付け、タグ管理。
- 検索バー: テキスト前方一致 + タグフィルタを統合。タグは OR 前提（`tagIds` を `array-contains-any` で取得し、複数選択時は「どれかを含む」と明示）。必要ならクライアント側で AND 絞り込みも検討するが初期実装は OR でOK。
- フレーズカード: テキスト、タグチップ（最大3件+more）、更新日時。
- 空状態: 「まだフレーズがありません」「+ 新規フレーズを追加」CTA。タグ作成導線も小さく置く。
- タグフィルタを維持したまま詳細表示→引用モーダルに渡せるようにする。
- 検索ロジックの共通化: `usePhraseSearch({ initialTagIds, mode: "screen" | "modal" })` のようなカスタムフックで検索＋タグフィルタを共通化し、Phrases画面と挿入モーダルの挙動を揃える。
- タグ管理UI: 画面右上の「タグを管理」からシート/モーダルを開き、タグの作成・編集・削除を行う。カラー選択も同シートで完結。
- フレーズ詳細からのタグ追加ショートカット: 詳細画面内に「新しいタグを作成」ボタンを置き、簡易作成ダイアログでタグ作成→そのまま対象フレーズに付与（tagIds 更新＋`tags/{tagId}/phraseRefs/{phraseId}` 追加）まで一気通貫で行う。

### 3. 設定（Settings）画面 (`app/settings.tsx`)
**機能**: 一般設定、データ管理、アプリ情報。
- シンプルなリストでOK。空状態なし。

## フレーズ挿入モーダル（プロジェクト詳細内）
- 起動: プロジェクト詳細の「フレーズを挿入」ボタン。
- 入力: テキスト検索 + タグフィルタ（チップ）。最近使ったタグを先頭に表示。
- 一覧: フレーズ本文＋タグチップ。タップでプレビュー→「このフレーズを挿入」CTA。
- 検索ロジック: Phrases 画面と共通のフックを利用（`usePhraseSearch({ mode: "modal", initialTagIds })`）。
- 挿入時: v1は「選択中セクションの末尾に1行追加」に限定。モーダルに `(phrase: Phrase) => void` コールバックを渡し、Project 詳細側で Line を追加。追加後にサクセストースト。カーソル位置挿入が必要になればUIと仕様を見直す。
- タグ軸検索は `tags/{tagId}/phraseRefs` を用いたクエリで実装する想定。

## プロジェクト詳細画面（例: `app/projects/[id].tsx`）
**役割**: 1プロジェクトのセクション/行編集とフレーズ挿入。
- ヘッダー: タイトル（直接編集可）＋「…」メニュー（削除/ゴミ箱移動など）。右上に「フレーズを挿入」CTA（モーダル起動）。
- セクション表示: タブ方式またはアコーディオン方式のどちらかで固定。
  - タブ方式（採用）: 上にセクションタブ（Aメロ/Bメロ/サビなど）→ 選択中セクションの行一覧を下に表示。シンプルで見通しが良い。
  - アコーディオン方式: （不採用）各セクションを折りたたみで表示する案。
- Line編集: 行ごとのインプット/テキストエリア。長押し/ハンドルで並び替え（`lineIndex` 更新）。右スワイプで削除。セクション単位で「+ 行を追加」ボタン、または最下行でEnter追加をサポート。
- フレーズ挿入: ヘッダーのCTAからモーダルを開き、タグ/テキスト検索 → 選択したフレーズを選択中セクションに挿入。挿入後はトーストで通知。
- ジャンルテンプレ適用済みの場合: セクション名/順番はテンプレから初期生成し、以後はユーザー自由編集（テンプレと同期しない）。

## ナビゲーション構成

### タブナビゲーション (`app/_layout.tsx`)
- ライブラリ: Expo Router Tabs
- アイコン: Material Icons
- カラー: アクティブ #007AFF / 非アクティブ #8E8E93
- ヘッダー: 非表示設定

### タブ詳細
| タブ | ファイル | アイコン | タイトル |
|------|----------|----------|----------|
| 歌詞 | `index.tsx` | `library-music` | 歌詞 |
| フレーズ | `phrases.tsx` | `format-quote` | フレーズ |
| 設定 | `settings.tsx` | `settings` | 設定 |

## デザインシステム

### カラーパレット
- プライマリ: #007AFF
- 背景: #F2F2F7
- カード背景: #FFFFFF
- テキスト: #000000 / #8E8E93
- 境界線: #E5E5EA

### コンポーネント共通仕様
- カード: 角丸12px、シャドウ小
- ヘッダー: 白背景、下境界線、24ptタイトル
- 検索バー: グレー背景、角丸10px、クリアボタン
- タグ: カラー付きチップ、角丸12px、選択時は枠線強調
- ダークモード対応は行わず、上記カラーを固定で使用

### レスポンシブ対応
- SafeAreaView
- FlatList/ScrollView
- flexレイアウト

## ジャンルテンプレートUIと運用
- 役割: プロジェクト作成時のセクション構成テンプレ。未選択でも作成可能。
- UI配置: プロジェクト作成モーダルに「ジャンル」セレクトを設置し、「セクション構成を自動追加」と注釈。常に `/genre_presets` の最新を取得して表示（同期/コピーの前提なし）。
- プリセット（運営提供）の管理:
  - 管理用コレクション例: `/genre_presets`（運営のみ編集、追記でバージョン管理）。
  - 利用方法: ユーザーはマスタを選択して適用するか、その場で「複製してカスタマイズ」を選び、ユーザー配下に新規ジャンルとして保存する（マスタは更新してもユーザー版に自動反映しない）。
- カスタム編集UI: 設定画面またはプロジェクト詳細のメニューに「ジャンルテンプレ編集」を配置。リスト＋編集モーダルで name/description/sections(name, orderIndex) を編集。空状態時は「まだジャンルテンプレはありません」「マスタから複製」CTAを表示。

## 用語ガイド（UIで補足するための短文）
- **プロジェクト**: 曲単位の入れ物。フォルダで整理し、セクションと行で構成。
- **フォルダ**: プロジェクトの整理用グループ。入れ子なし。「フォルダなし」タブで未分類を表示。
- **セクション**: 曲のパート（Aメロ/サビなど）。並べ替え可。
- **行 (Line)**: 歌詞1行。並べ替え・削除・挿入が可能。
- **フレーズ**: プロジェクト外のストックメモ。タグで分類し、プロジェクトに挿入可能。
- **タグ**: フレーズに付けるラベル。チップ表示。タグ検索は「どれかを含む（OR）」で実装。
- **ジャンルテンプレ**: セクション構成のプリセット。マスタ（運営）とユーザー複製版を分離管理。
